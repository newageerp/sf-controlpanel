import React, {useEffect, useState} from "react";
import { useTranslation } from "react-i18next";
import TP_TABLE_COMP_NAME from "../tables/TP_TABLE_COMP_NAME"
import { OpenApi } from '@newageerp/nae-react-auth-wrapper';
import { functions } from '@newageerp/nae-react-ui';
import { PageContainer, PageContainerTopMargin } from '@newageerp/ui.paging.base.page-container'
import { SearchToolbar, SearchToolbarMarginBottom } from '@newageerp/ui.components.list.search-toolbar'

export default function TP_COMP_NAME() {
    const [activePage, setActivePage] = useState(1);
    const pageSize = TP_PAGE_SIZE;

    const tab = functions.tabs.getTabFromSchemaAndType('TP_SCHEMA', 'TP_TYPE');
    const fieldsToReturn = functions.tabs.getTabFieldsToReturn(tab);

    const [getData, dataResult] = OpenApi.useUList('TP_SCHEMA', fieldsToReturn);
    const { t } = useTranslation();

    const loadData = () => {
        const predefinedFilter = TP_FILTER;
        let _filter: any = [{ and: [] }]
        if (!!predefinedFilter) {
            _filter[0]['and'].push(predefinedFilter);
        }
        let filter = _filter[0]['and'].length > 0 ? _filter : []


        const sort = TP_SORT;
        getData(
            filter,
            activePage,
            pageSize,
            sort
        );
    }
    useEffect(loadData, [activePage]);

    const records = dataResult.data.records;
    const pages = Math.ceil(records / pageSize);

    return (
        <div>
            <SearchToolbar marginBottom={SearchToolbarMarginBottom['40px'}/>
            <TP_TABLE_COMP_NAME data={dataResult.data.data} />
            <PageContainer pages={pages} activePage={activePage} setActivePage={setActivePage} topMargin={PageContainerMarginTop['42px']} />
        </div>
    )
}